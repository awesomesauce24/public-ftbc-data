{% extends "base.html" %}

{% block title %}{% if obj_id is not none %}Edit{% else %}Create{% endif %} - {{ realm_name }}{% endblock %}

{% block content %}
<div class="breadcrumb">
    <a href="/">Create Pages</a> / <strong>{{ realm_name }}</strong>
</div>

<h1>{% if obj_id is not none %}Edit Page{% else %}New Page{% endif %}</h1>
<p class="subtitle">{{ realm_name }}</p>

<form id="pageForm" class="edit-form">
    <div class="form-group">
        <label for="ObjectName">Object Name *</label>
        <input type="text" id="ObjectName" name="ObjectName" value="{{ obj.get('ObjectName', '') }}" placeholder="e.g., Golden Trophy" required>
    </div>

    <div class="form-group">
        <label for="Difficulty">Difficulty *</label>
        <select id="Difficulty" name="Difficulty" required>
            <option value="">-- Select --</option>
            <option value="easy" {% if obj.get('Difficulty') == 'easy' %}selected{% endif %}>Easy</option>
            <option value="normal" {% if obj.get('Difficulty') == 'normal' %}selected{% endif %}>Normal</option>
            <option value="hard" {% if obj.get('Difficulty') == 'hard' %}selected{% endif %}>Hard</option>
            <option value="intermediate" {% if obj.get('Difficulty') == 'intermediate' %}selected{% endif %}>Intermediate</option>
            <option value="terrifying" {% if obj.get('Difficulty') == 'terrifying' %}selected{% endif %}>Terrifying</option>
        </select>
    </div>

    <div class="form-group">
        <label for="Description">Description/Hint *</label>
        <textarea id="Description" name="Description" rows="3" placeholder="Brief description of where/how to find it" required>{{ obj.get('Description', '') }}</textarea>
    </div>

    <div class="form-group">
        <label for="Section">Section (Optional)</label>
        <input type="text" id="Section" name="Section" value="{{ obj.get('Section', '') }}" placeholder="e.g., Main Area, Hidden Room">
    </div>

    <div class="form-group">
        <label for="Area">Area (Optional)</label>
        <input type="text" id="Area" name="Area" value="{{ obj.get('Area', '') }}" placeholder="e.g., North Wing">
    </div>

    <div class="form-actions">
        <button type="submit" class="btn btn-primary">üíæ Save Page</button>
        <a href="/" class="btn btn-secondary">Cancel</a>
    </div>

    <p class="help-text">üìå After saving, publish your changes to make them visible on the wiki!</p>
</form>

<script>
document.getElementById('pageForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const formData = new FormData(this);
    const obj = Object.fromEntries(formData);
    {% if obj_id is not none %}
    obj.id = {{ obj_id }};
    {% endif %}
    
    const url = '/api/realm/{{ realm_name }}/object';
    
    const response = await fetch(url, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(obj)
    });
    
    const result = await response.json();
    if(result.status === 'ok') {
        alert('‚úÖ ' + result.message);
        window.location.href = '/';
    } else {
        alert('‚ùå Error: ' + result.message);
    }
});
</script>
{% endblock %}
